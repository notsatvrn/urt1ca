// Port of "iosurface.h" from Jake James' sock_port.

const mach = @cImport(@cInclude("mach/mach.h"));
const IOKit = @cImport(@cInclude("iokit.h"));

const utils = @import("../utils.zig");
const std = @import("std");

var iosurface_initialized = false;

pub fn iosurfaceInit() bool {
    if (iosurface_initialized) {
        return true;
    }
    const IOSurfaceRoot = IOKit.IOServiceGetMatchingService(
        IOKit.kIOMasterPortDefault,
        IOKit.IOServiceMatching("IOSurfaceRoot"),
    );
    if (IOSurfaceRoot == mach.MACH_PORT_NULL) {
        utils.error("could not find IOSurfaceRoot", .{});
        return false;
    }
    const kr = IOKit.IOServiceOpen(
        IOSurfaceRoot,
        mach.mach_task_self(),
        0,
        &IOSurfaceRootUserClient,
    );
    if (kr != IOKit.KERN_SUCCESS) {
        utils.error("could not find IOSurfaceRootUserClient", .{});
        return false;
    }
} 
